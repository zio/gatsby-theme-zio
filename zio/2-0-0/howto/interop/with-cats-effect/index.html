<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.17.2"/><style data-href="/styles.0d77a1f9790ad3befaea.css" data-identity="gatsby-global-css">/*
! tailwindcss v3.1.4 | MIT License | https://tailwindcss.com
*/*,:after,:before{border:0 solid #e5e7eb;box-sizing:border-box}:after,:before{--tw-content:""}html{-webkit-text-size-adjust:100%;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{line-height:inherit;margin:0}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{color:inherit;font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }::-webkit-backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1536px){.container{max-width:1536px}}.invisible{visibility:hidden}.absolute{position:absolute}.relative{position:relative}.left-0{left:0}.top-1\/2{top:50%}.z-10{z-index:10}.m-4{margin:1rem}.m-auto{margin:auto}.my-2{margin-bottom:.5rem;margin-top:.5rem}.my-auto{margin-bottom:auto;margin-top:auto}.mx-auto{margin-left:auto;margin-right:auto}.mx-1{margin-right:.25rem}.ml-1,.mx-1{margin-left:.25rem}.mr-8{margin-right:2rem}.mt-4{margin-top:1rem}.mt-2{margin-top:.5rem}.ml-2{margin-left:.5rem}.mb-2{margin-bottom:.5rem}.ml-5{margin-left:1.25rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-8{height:2rem}.h-0{height:0}.h-40{height:10rem}.h-auto{height:auto}.w-full{width:100%}.w-auto{width:auto}.w-80{width:20rem}.w-8{width:2rem}.w-11\/12{width:91.666667%}.max-w-full{max-width:100%}.flex-initial{flex:0 1 auto}.flex-none{flex:none}.flex-grow{flex-grow:1}.list-outside{list-style-position:outside}.list-disc{list-style-type:disc}.list-decimal{list-style-type:decimal}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.place-content-center{place-content:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.rounded-lg{border-radius:.5rem}.rounded-xl{border-radius:.75rem}.rounded-sm{border-radius:.125rem}.border-2{border-width:2px}.border-r-2{border-right-width:2px}.border-solid{border-style:solid}.border-primary-50{--tw-border-opacity:1;border-color:rgb(250 250 249/var(--tw-border-opacity))}.bg-primary-700{--tw-bg-opacity:1;background-color:rgb(68 64 60/var(--tw-bg-opacity))}.bg-primary-900{--tw-bg-opacity:1;background-color:rgb(28 25 23/var(--tw-bg-opacity))}.bg-primary-100{--tw-bg-opacity:1;background-color:rgb(245 245 244/var(--tw-bg-opacity))}.bg-primary-300{--tw-bg-opacity:1;background-color:rgb(214 211 209/var(--tw-bg-opacity))}.bg-black{--tw-bg-opacity:1;background-color:rgb(0 0 0/var(--tw-bg-opacity))}.p-4{padding:1rem}.p-2{padding:.5rem}.p-8{padding:2rem}.px-1{padding-left:.25rem;padding-right:.25rem}.pb-4{padding-bottom:1rem}.pr-2{padding-right:.5rem}.text-center{text-align:center}.text-right{text-align:right}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.text-sm{font-size:.875rem;line-height:1.25rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.font-bold{font-weight:700}.font-semibold{font-weight:600}.text-primary-50{--tw-text-opacity:1;color:rgb(250 250 249/var(--tw-text-opacity))}.text-secondary-600{--tw-text-opacity:1;color:rgb(220 38 38/var(--tw-text-opacity))}.underline{-webkit-text-decoration-line:underline;text-decoration-line:underline}.hover\:rounded-md:hover{border-radius:.375rem}.hover\:bg-primary-700:hover{--tw-bg-opacity:1;background-color:rgb(68 64 60/var(--tw-bg-opacity))}.hover\:bg-primary-600:hover{--tw-bg-opacity:1;background-color:rgb(87 83 78/var(--tw-bg-opacity))}@media (min-width:768px){.md\:visible{visibility:visible}.md\:h-auto{height:auto}.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\:flex-row{flex-direction:row}}@media (min-width:1024px){.lg\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:#2f2f2f;color:#eee;font-family:Roboto Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{background:#363636}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#363636}:not(pre)>code[class*=language-]{border-radius:.2em;padding:.1em;white-space:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1.25em 1em;position:relative}.language-css>code,.language-sass>code,.language-scss>code{color:#fd9170}[class*=language-] .namespace{opacity:.7}.token.atrule{color:#c792ea}.token.attr-name{color:#ffcb6b}.token.attr-value,.token.attribute{color:#a5e844}.token.boolean{color:#c792ea}.token.builtin{color:#ffcb6b}.token.cdata,.token.char{color:#80cbc4}.token.class{color:#ffcb6b}.token.class-name{color:#f2ff00}.token.comment{color:#616161}.token.constant{color:#c792ea}.token.deleted{color:#f66}.token.doctype{color:#616161}.token.entity{color:#f66}.token.function{color:#c792ea}.token.hexcode{color:#f2ff00}.token.id,.token.important{color:#c792ea;font-weight:700}.token.inserted{color:#80cbc4}.token.keyword{color:#c792ea}.token.number{color:#fd9170}.token.operator{color:#89ddff}.token.prolog{color:#616161}.token.property{color:#80cbc4}.token.pseudo-class,.token.pseudo-element{color:#a5e844}.token.punctuation{color:#89ddff}.token.regex{color:#f2ff00}.token.selector{color:#f66}.token.string{color:#a5e844}.token.symbol{color:#c792ea}.token.tag{color:#f66}.token.unit{color:#fd9170}.token.url,.token.variable{color:#f66}</style><title data-react-helmet="true"></title></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="container mx-auto"><h2>Introduction</h2><p><a href="https://github.com/zio/interop-cats"><code>interop-cats</code></a> has instances for the <a href="https://typelevel.org/cats/">Cats</a>, <a href="https://github.com/typelevel/cats-mtl">Cats MTL</a> and <a href="https://typelevel.org/cats-effect/">Cats Effect</a> libraries, which allow you to use ZIO with any libraries that rely on these, like <a href="https://github.com/tpolecat/doobie">Doobie</a>, <a href="https://github.com/http4s/http4s">Http4s</a>, <a href="https://github.com/functional-streams-for-scala/fs2">FS2</a> or <a href="https://github.com/circe/circe">Circe</a></p><p>Depends on which version of Cats Effect we are using, we should pick the right version of <code>zio-interop-cats</code>. In this tutorial, whenever we&#x27;re working with Cats Effect 2.x, we are using:</p><pre><code class="language-scala">libraryDependencies += &quot;dev.zio&quot; %% &quot;zio-interop-cats&quot; % &quot;2.5.1.0&quot;
</code></pre><p>And whenever we are using Cats Effect 3.x instances, we are using:</p><pre><code class="language-scala">libraryDependencies += &quot;dev.zio&quot; %% &quot;zio-interop-cats&quot; % &quot;3.1.1.0&quot;
</code></pre><p>Most of the interop functionality resides in the following package:</p><pre><code class="language-scala">import zio.interop.catz._
</code></pre><h2>Cats Effect Instances</h2><p>ZIO integrates with Typelevel libraries by providing instances of Cats Effect type classes. These type classes are used by <code>fs2</code>, <code>doobie</code>, <code>http4s</code>, and a variety of other libraries in the functional Scala ecosystem.</p><p>Due to the limitations of the Cats Effect, ZIO cannot provide instances for arbitrary error types. Instead, we can obtain instances only for effects whose error type extends <code>Throwable</code>.</p><p>For convenience, ZIO includes the <code>Task</code> and <code>RIO</code> type aliases, which fix the error type to <code>Throwable</code>, and may be useful for interop with Cats Effect:</p><pre><code class="language-scala">import zio.{ZIO, Task, RIO}
</code></pre><pre><code class="language-scala">type Task[+A]    = ZIO[Any, Throwable, A]
type RIO[-R, +A] = ZIO[  R, Throwable, A]
</code></pre><h3>Providing Runtime Manually</h3><p>To use Cats Effect instances for these types, we should have an implicit <code>Runtime[R]</code> in scope for the environment type of our effects. The following code snippet creates an implicit <code>Runtime</code> for all the modules built into ZIO:</p><pre><code class="language-scala">import cats.implicits._
import zio.interop.catz._

object ZioCatsEffectInterop extends scala.App {
  def catsEffectApp[F[_]: cats.effect.Sync]: F[Unit] =
    cats.effect.Sync[F].delay(
        println(&quot;Hello from Cats Effect World!&quot;)
      )
      
  implicit val runtime: zio.Runtime[zio.ZEnv] = zio.Runtime.default

  val zioApp: zio.Task[Unit] = catsEffectApp[zio.Task]
  runtime.unsafeRun(zioApp.exitCode)
}
</code></pre><p>If we are working with Cats Effect 3.x, the <code>catsEffectApp[Task]</code> will be expanded as if we called the following code explicitly:</p><pre><code class="language-scala">import ZioCatsEffectInterop.catsEffectApp
</code></pre><pre><code class="language-scala">object ZioCatsEffectInterop extends scala.App {
  val runtime: zio.Runtime[zio.ZEnv] = zio.Runtime.default
  
  val zioApp: zio.Task[Unit] = catsEffectApp[zio.Task](
    zio.interop.catz.asyncRuntimeInstance(runtime) 
  )
  
  runtime.unsafeRun(zioApp.exitCode) 
}
</code></pre><p>And if we are working with Cats Effect 2.x, it will be expanded as if we called following code explicitly:</p><pre><code class="language-scala">object ZioCatsEffectInterop extends scala.App {
  val runtime: zio.Runtime[zio.ZEnv] = zio.Runtime.default

  val zioApp = catsEffectApp[zio.Task](zio.interop.catz.taskConcurrentInstance)
  runtime.unsafeRun(zioApp.exitCode)
}
</code></pre><p>If we are using <code>RIO</code> for a custom environment <code>R</code>, then we will have to create our own <code>Runtime[R]</code>, and ensure that implicit wherever we need Cats Effect instances.</p><h3>Using <code>CatsApp</code> Runtime</h3><p>As a convenience, our application can extend <code>CatsApp</code>, which automatically brings an implicit <code>Runtime[ZEnv]</code> into our scope:</p><pre><code class="language-scala">import zio.interop.catz._
import cats.implicits._

object ZioCatsEffectInteropWithCatsApp extends CatsApp {
  def catsEffectApp[F[_]: cats.effect.Sync]: F[Unit] =
    cats.effect.Sync[F].delay(println(&quot;Hello from Cats Effect World!&quot;))

  override def run(args: List[String]): zio.URIO[zio.ZEnv, zio.ExitCode] = 
    catsEffectApp[zio.Task].exitCode
}
</code></pre><p>This example works properly in both Cats Effect 2.x and 3.x versions.</p><h2>Cats Effect 2.x</h2><h3>Timer Instance</h3><p>In order to get a <code>cats.effect.Timer[zio.Task]</code> instance, we need an extra import (<code>zio.interop.catz.implicits._</code>):</p><pre><code class="language-scala">import java.util.concurrent.TimeUnit

import cats.implicits._
import zio.interop.catz._
import zio.interop.catz.implicits._ // Provides `zio.Task instance` for `cats.effect.Time` type class
import zio.{ ExitCode, Task, URIO }

import scala.concurrent.duration.DurationInt

object ZioCatsEffectTimerInterop extends zio.interop.catz.CatsApp {
  override def run(args: List[String]): zio.URIO[zio.ZEnv, zio.ExitCode] =
    catsEffectTimerApp[zio.Task].exitCode

  def catsEffectTimerApp[F[_]: cats.effect.Clock: cats.effect.Timer: cats.effect.Sync]: F[Unit] = for {
    t2 &lt;- cats.effect.Clock[F].monotonic(TimeUnit.SECONDS)
    _  &lt;- cats.effect.Timer[F].sleep(2.seconds)
    t1 &lt;- cats.effect.Clock[F].monotonic(TimeUnit.SECONDS)
    _  &lt;- cats.effect.Sync[F].delay(println(t1 - t2))
  } yield ()
}
</code></pre><p>The reason a <code>cats.effect.Timer[zio.Task]</code> instance is not provided by the default <em>interop</em> import is that it makes testing programs that require timing capabilities very difficult. The extra import (wherever needed) makes reasoning about timing-related effects much easier.</p><p>If we&#x27;re using <code>RIO</code> for a custom environment then our environment must use the <code>Clock</code> service, e.g. <code>R &lt;: Clock</code> to get a timer.</p><h3>Converting Resource to ZManaged</h3><p>To convert Cats Effect <code>Resource</code> into <code>ZManaged</code>, we can call <code>toManaged</code> on <code>Resource</code>.</p><p>For example, assume we have the following <code>File</code> API:</p><pre><code class="language-scala">case class File[F[_]: cats.effect.Sync]() {
  import cats.syntax.apply._
  def read: F[String] =
    cats.effect.Sync[F].delay(println(&quot;Reading file.&quot;)) *&gt;
      cats.effect.Sync[F].pure(&quot;Hello, World!&quot;)
  def close: F[Unit]  =
    cats.effect.Sync[F].delay(println(&quot;Closing file.&quot;))
}

object File {
  import cats.syntax.apply._
  def open[F[_]: cats.effect.Sync](name: String): F[File[F]] =
    cats.effect.Sync[F].delay(println(s&quot;opening $name file&quot;)) *&gt;
      cats.effect.Sync[F].delay(File())
}
</code></pre><p>And, also assume we have <code>fileResource</code> defined as follows:</p><pre><code class="language-scala">def fileResource[F[_]: cats.effect.Sync](name: String): cats.effect.Resource[F, File[F]] =
  cats.effect.Resource.make(File.open[F](name))(_.close)
</code></pre><p>Let&#x27;s convert that to <code>ZManaged</code>:</p><pre><code class="language-scala">val resource: zio.ZManaged[zio.ZEnv, Throwable, File[zio.Task]] =
  fileResource[zio.Task](&quot;log.txt&quot;).toManaged[zio.ZEnv]
</code></pre><p>Here is a complete working example:</p><pre><code class="language-scala">import zio.interop.catz._

object CatsEffectResourceInterop extends CatsApp {
  def fileResource[F[_]: cats.effect.Sync](name: String): cats.effect.Resource[F, File[F]] =
    cats.effect.Resource.make(File.open[F](name))(_.close)

  def myApp: zio.ZIO[zio.ZEnv, Throwable, Unit] = for {
    c &lt;- fileResource[zio.Task](&quot;log.txt&quot;).toManaged[zio.ZEnv].use(_.read)
    _ &lt;- zio.console.putStr(s&quot;file content: $c&quot;)
  } yield ()

  override def run(args: List[String]): zio.URIO[zio.ZEnv, zio.ExitCode] =
    myApp.exitCode
}
</code></pre><h3>Converting ZManaged to Resource</h3><p>We have an extension method on <code>ZManaged</code> called <code>ZManaged#toResource</code> which converts a ZIO managed resource to Cats Effect resource:</p><pre><code class="language-scala">final class ZManagedSyntax[R, E, A](private val managed: ZManaged[R, E, A]) {
  def toResource[F[_]](implicit
      F: Async[F],
      ev: Effect[ZIO[R, E, *]]
  ): Resource[F, A] = ???
}
</code></pre><p>Let&#x27;s try an example:</p><pre><code class="language-scala">import zio.interop.catz._

object ZManagedToResource extends cats.effect.IOApp {
  implicit val zioRuntime: zio.Runtime[zio.ZEnv] = zio.Runtime.default

  val resource: cats.effect.Resource[cats.effect.IO, java.io.InputStream] =
    zio.ZManaged
      .fromAutoCloseable(
        zio.ZIO.effect(
          java.nio.file.Files.newInputStream(
            java.nio.file.Paths.get(&quot;file.txt&quot;)
          )
        )
      )
      .toResource[cats.effect.IO]

  val effect: cats.effect.IO[Unit] =
    resource
      .use { is =&gt;
        cats.effect.IO.delay(is.readAllBytes())
      }
      .flatMap(bytes =&gt;
        cats.effect.IO.delay(
          println(s&quot;file length: ${bytes.length}&quot;)
        )
      )

  override def run(args: List[String]): cats.effect.IO[cats.effect.ExitCode] =
    effect.as(cats.effect.ExitCode.Success)
}
</code></pre><h2>Cats Effect 3.x</h2><h3>Type class Instances for ZIO&#x27;s Task</h3><p>ZIO integrates with Cats Effect 3.x as well as 2.x. The <code>interop-cats</code> module provides <code>Concurrent</code>, <code>Temporal</code> and <code>Async</code> for <code>zio.Task</code>.</p><p>An example of ZIO interoperability with CE3:</p><pre><code class="language-scala">import cats.implicits._
import zio.interop.catz._
import scala.concurrent.duration.DurationInt

object ZioCatsEffectInterop extends zio.interop.catz.CatsApp {

  def catsEffectTimerApp[F[_]: cats.effect.Async]: F[Unit] = for {
    t2 &lt;- cats.effect.Clock[F].monotonic
    _  &lt;- cats.effect.Temporal[F].sleep(2.seconds)
    t1 &lt;- cats.effect.Clock[F].monotonic
    _  &lt;- cats.effect.Sync[F].delay(println(t1 - t2))
  } yield ()
  
  override def run(args: List[String]): zio.URIO[zio.ZEnv, zio.ExitCode] = {
    catsEffectTimerApp[zio.Task].exitCode
  }
}
</code></pre><h3>Converting Resource to ZManaged</h3><p>To convert a Cats Effect&#x27;s <code>Resource</code> to <code>ZManaged</code> we can use <code>cats.effect.Resource#toZManaged</code> extension method by importing <code>zio.interop.catz._</code> package and also we should provide an implicit instance of <code>Dispatcher</code>:</p><pre><code class="language-scala">import zio.interop.catz._
import scala.concurrent.ExecutionContextExecutor

object ResourceToZManagedExample extends zio.App {
  implicit val ceRuntime: cats.effect.unsafe.IORuntime =
    cats.effect.unsafe.IORuntime.global
  implicit val ec: ExecutionContextExecutor =
    scala.concurrent.ExecutionContext.global

  implicit val dispatcher: cats.effect.std.Dispatcher[cats.effect.IO] =
    cats.effect.std
      .Dispatcher[cats.effect.IO]
      .allocated
      .unsafeRunSync()
      ._1

  def catsResource[F[_]: cats.effect.Sync]
      : cats.effect.Resource[F, java.io.InputStream] =
    cats.effect.Resource
      .fromAutoCloseable(
        cats.effect
          .Sync[F]
          .delay(
            java.nio.file.Files.newInputStream(
              java.nio.file.Paths.get(&quot;file.txt&quot;)
            )
          )
      )

  val myApp: zio.ZIO[zio.console.Console, Throwable, Unit] =
    catsResource[cats.effect.IO].toManaged
      .use { is =&gt;
        zio.console.putStrLn(is.readAllBytes().length.toString)
      }
      
  override def run(args: List[String]): zio.URIO[zio.ZEnv, zio.ExitCode] =
    myApp.exitCode
}
</code></pre><h2>Cats Core</h2><p>There is another package in <code>interop-cats</code> module called <code>zio.interop.catz.core._</code> which helps us to interop with core data types. This package contains instances of <code>zio.Chunk</code> data type for Cats Core module like <code>cats.Order</code>, <code>cats.Hash</code>, <code>cats.Traverse</code>, and so forth.</p><p>In the following example, we are going to use <code>zio.Chunk</code> in a Cats Effect application:</p><pre><code class="language-scala">import cats.implicits._
import zio.interop.catz.core._

object ZioInteropWithCatsCore extends cats.effect.IOApp {
  val chunk = zio.Chunk(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;)

  def parseInt(s: String): Option[Int] =
    Either.catchOnly[NumberFormatException](s.toInt).toOption

  val parseAll = cats.Traverse[zio.Chunk].traverse(chunk)(parseInt)

  override def run(args: List[String]): cats.effect.IO[cats.effect.ExitCode] =
    cats.effect.IO.println(parseAll).as(cats.effect.ExitCode.Success)
}
</code></pre><p>This package also contains utilities to support <code>zio.NonEmptyChunk</code> interoperability with Cats Core module.</p><h2>FS2 Streams</h2><p>The <code>interop-cats</code> module contains extension methods to convert <em>FS2 Stream</em> to <em>ZStream</em> and vice versa. These methods support both FS2 series, 2.x and 3.x:</p><h3>From FS2 Stream to ZStream</h3><p>By importing <code>zio.stream.interop.fs2z._</code> into our application, the <code>fs2.Stream#toZStream</code> extension method converts a <code>fs2.Stream</code> to <code>ZStream</code>:</p><pre><code class="language-scala">import zio.stream.ZStream
import zio.stream.interop.fs2z._
val zstream: ZStream[Any, Throwable, Int] = fs2.Stream.range(1, 10).toZStream()
</code></pre><h3>From ZStream to FS2 Stream</h3><p>Also, the <code>ZStream#toFs2Stream</code> converts a ZIO Stream into FS2 Stream:</p><pre><code class="language-scala">import zio.stream.ZStream
import zio.Chunk
import zio.stream.interop.fs2z._
val fs2stream = ZStream.fromChunks(Chunk(1, 2, 3, 4)).toFs2Stream
</code></pre><h2>Using Queue with Cats Effect</h2><p>The <code>interop-cats</code> library has an <code>import zio.interop.Queue</code> package to lift creation of <code>Queue</code> effect from <code>UIO[Queue[A]]</code> to <code>F[Queue[F, A]]</code> which enables us to run <code>Queue</code> under Cats Effect runtime. It supports all variants of <code>Queue</code> like <code>bounded</code>, <code>unbounded</code>, <code>sliding</code> and <code>dropping</code>.</p><pre><code class="language-scala">def bounded[F[+_], A](capacity: Int)(implicit R: Runtime[ZEnv], F: LiftIO[F]): F[Queue[F, A]]
</code></pre><h3>Cats Effect 2.x</h3><p>In the following example, we are going to lift the <code>Queue</code> creation effect to Cats <code>IO</code> effect. If we are integrating with 2.x Cats Effect library, this snippet works properly:</p><pre><code class="language-scala">import zio.interop.Queue
import cats.effect.IO

implicit val runtime = Runtime.default
def liftedToIO: IO[List[Int]] = for {
  q &lt;- Queue.bounded[IO, Int](100)
  _  &lt;- q.offer(1)
  _  &lt;- q.offer(2)
  r &lt;- q.takeAll
} yield (r)
</code></pre><h3>Cats Effect 3.x</h3><p>To run <code>Queue</code> with Cats Effect 3.x we also need to provide an instance of <code>Dispatcher</code> to our contextual environment:</p><pre><code class="language-scala">import zio.interop.Queue

object ZioQueueInteropWithCats extends scala.App {

  implicit val ceRuntime: cats.effect.unsafe.IORuntime =
    cats.effect.unsafe.IORuntime.global

  implicit val zioRuntime: zio.Runtime[zio.ZEnv] =
    zio.Runtime.default

  implicit val ec: scala.concurrent.ExecutionContextExecutor =
    scala.concurrent.ExecutionContext.global

  implicit val dispatcher: cats.effect.std.Dispatcher[cats.effect.IO] =
    cats.effect.std
      .Dispatcher[cats.effect.IO]
      .allocated
      .unsafeRunSync()
      ._1

  def liftedToIO: cats.effect.IO[List[Int]] = for {
    q &lt;- Queue.bounded[cats.effect.IO, Int](100)
    _ &lt;- q.offer(1)
    _ &lt;- q.offer(2)
    r &lt;- q.takeAll
  } yield (r)

  val catsApp = liftedToIO
    .flatMap { e =&gt;
      cats.effect.IO.println(s&quot;List of elements retrieved from Queue: $e&quot;)
    }
    .as(cats.effect.ExitCode.Success)

  catsApp.unsafeRunSync()
}
</code></pre><h2>Using STM with Cats Effect</h2><p>The <code>zio.interop.stm</code> provides a wrapper data type on <code>STM[Throwable, A]</code> which enables us to run <code>STM</code> with the Cats Effect library.</p><p>Currently, the <code>interop-cats</code> support <code>TRef</code>, <code>TPromise</code>,  <code>TQueue</code> and <code>TSemaphore</code> data types.</p><p>Let&#x27;s try a working example using <code>STM</code> and <code>TRef</code>:</p><pre><code class="language-scala">import cats.effect.IO
import cats.effect.unsafe.IORuntime
import zio.interop.stm.{STM, TRef}

implicit val zioRuntime: zio.Runtime[zio.ZEnv] = zio.Runtime.default
implicit val catsRuntime: IORuntime            = IORuntime.global

def transferMoney(
    from: TRef[IO, Long],
    to: TRef[IO, Long],
    amount: Long
): STM[IO, Long] =
  for {
    senderBal &lt;- from.get
    _ &lt;-
      if (senderBal &lt; amount)
        STM.fail[IO](new Exception(&quot;Not enough money&quot;))
      else
        STM.unit[IO]
    _       &lt;- from.update(existing =&gt; existing - amount)
    _       &lt;- to.update(existing =&gt; existing + amount)
    recvBal &lt;- to.get
  } yield recvBal

val program: IO[Long] = for {
  sndAcc &lt;- STM.atomically[cats.effect.IO, TRef[IO, Long]](
    TRef.make[IO, Long](1000)
  )
  rcvAcc &lt;- STM.atomically[cats.effect.IO, TRef[IO, Long]](
    TRef.make[IO, Long](200)
  )
  recvAmt &lt;- STM.atomically(transferMoney(sndAcc, rcvAcc, 500L))
} yield recvAmt

program
  .flatMap(amount =&gt;
    IO.println(s&quot;Balance of second account after transaction: $amount&quot;)
  )
  .unsafeRunSync()
</code></pre><h2>Examples</h2><p>Cats Effect and Type-Level libraries are older than the ZIO ecosystem. So there are very nice libraries like doobie and http4s, that a ZIO user would like to use in its application.</p><p>We have provided some full working example of using these important libraries:</p><h3>Using ZIO with Doobie</h3><p>The following example shows how to use ZIO with Doobie (a library for JDBC access) and FS2 (a streaming library), which both rely on Cats Effect instances:</p><pre><code class="language-scala">// This snippet works with both CE2 and CE3
import doobie._
import doobie.implicits._
import fs2.Stream
import zio.Task
import zio.interop.catz._

implicit val zioRuntime: zio.Runtime[zio.ZEnv] = zio.Runtime.default

case class User(id: String, name: String, age: Int)

def xa: Transactor[Task] =
  Transactor.fromDriverManager[Task](
    &quot;org.h2.Driver&quot;,
    &quot;jdbc:h2:mem:users;DB_CLOSE_DELAY=-1&quot;
  )

def createTable: doobie.ConnectionIO[Int] =
  sql&quot;&quot;&quot;|CREATE TABLE IF NOT EXISTS USERS(
        |id   INT SERIAL UNIQUE,
        |name VARCHAR NOT NULL UNIQUE,
        |age  SMALLINT
        |)&quot;&quot;&quot;.stripMargin.update.run

def dropTable: doobie.ConnectionIO[Int] =
  sql&quot;&quot;&quot;DROP TABLE IF EXISTS USERS&quot;&quot;&quot;.update.run

def insert(name: String, age: Int): doobie.ConnectionIO[Int] =
  sql&quot;insert into users (name, age) values ($name, $age)&quot;.update.run

def loadUsers: Stream[doobie.ConnectionIO, User] =
  sql&quot;&quot;&quot;SELECT * FROM users&quot;&quot;&quot;.query[User].stream

val doobieApp: Stream[doobie.ConnectionIO, User] = for {
  _ &lt;- fs2.Stream.eval(dropTable)
  _ &lt;- fs2.Stream.eval(createTable)
  _ &lt;- fs2.Stream.eval(insert(&quot;Olivia&quot;, 21))
  _ &lt;- fs2.Stream.eval(insert(&quot;Oliver&quot;, 30))
  u &lt;- loadUsers
} yield u

val run: Stream[Task, User] = doobieApp.transact(xa)

val allUsers: List[User] =
  zioRuntime.unsafeRun(run.compile.toList)
</code></pre><p>Sounds good, but how can we specify a specialized transactor than the default one? Creating a customized transactor in CE2 differs from CE3. </p><p>Let&#x27;s try doing that in each of which:</p><h4>Customized Transactor (CE2)</h4><p>ZIO provides a specific blocking thread pool for blocking operations. The <code>doobie-hikari</code> module helps us create a transactor with two separated executors, one for blocking operations like JDBC operations, and the other one for non-blocking operations like performing awaiting connections to the database. So we shouldn&#x27;t run blocking JDBC operations on the main thread pool. </p><p>So let&#x27;s fix this issue in the previous example. In the following snippet we are going to create a <code>ZMHikari</code> of Hikari transactor. In this example we are using <code>0.13.4</code> version of doobie which supports CE2:</p><pre><code class="language-scala">import zio.ZManaged
import zio.{ Runtime, Task, ZIO, ZManaged }
import doobie.hikari.HikariTransactor
import cats.effect.Blocker
import zio.interop.catz._

def transactor: ZManaged[Any, Throwable, HikariTransactor[Task]] =
  for {
    rt &lt;- ZIO.runtime[Any].toManaged
    be &lt;- ZIO.blockingExecutor.toManaged                          // our blocking EC
    xa &lt;- HikariTransactor
            .newHikariTransactor[Task](
              &quot;org.h2.Driver&quot;,                                    // driver classname
              &quot;jdbc:h2:mem:test;DB_CLOSE_DELAY=-1&quot;,               // connect URL
              &quot;sa&quot;,                                               // username
              &quot;&quot;,                                                 // password
              rt.runtimeConfig.executor.asExecutionContext,       // await connection here
              Blocker.liftExecutionContext(be.asExecutionContext) // execute JDBC operations here
            )
            .toManagedZIO
  } yield xa
</code></pre><p>Now we can <code>transact</code> our <code>doobieApp</code> with this <code>transactor</code> and convert that to the <code>ZIO</code> effect:</p><pre><code class="language-scala">val zioApp: ZIO[Any, Throwable, List[User]] =
  transactor.use(xa =&gt; doobieApp.transact(xa).compile.toList)
</code></pre><h4>Customized Transactor (CE3)</h4><p>In Cats Effect 3.x, the <code>cats.effect.Blocker</code> has been removed. So the transactor constructor doesn&#x27;t require us a blocking executor; it happens under the hood using the <code>Sync[F].blocking</code> operation.</p><p>To create a <code>Transactor</code> in CE3, we need to create an instance of <code>Dispatcher</code> for <code>zio.Task</code>. The following example is based on Doobie&#x27;s <code>1.0.0-M5</code> version which supports CE3:</p><pre><code class="language-scala">import doobie.hikari.HikariTransactor
import zio.interop.catz._
import zio.{Task, ZIO, ZManaged}

implicit val zioRuntime: zio.Runtime[zio.ZEnv] =
  zio.Runtime.default

implicit val dispatcher: cats.effect.std.Dispatcher[zio.Task] =
  zioRuntime
    .unsafeRun(
      cats.effect.std
        .Dispatcher[zio.Task]
        .allocated
    )
    ._1

def transactor: ZManaged[Any, Throwable, HikariTransactor[Task]] =
  for {
    rt &lt;- ZIO.runtime[Any].toManaged
    xa &lt;-
      HikariTransactor
        .newHikariTransactor[Task](
          &quot;org.h2.Driver&quot;,                             // driver classname
          &quot;jdbc:h2:mem:test;DB_CLOSE_DELAY=-1&quot;,        // connect URL
          &quot;sa&quot;,                                        // username
          &quot;&quot;,                                          // password
          rt.runtimeConfig.executor.asExecutionContext // await connection here
        )
        .toManaged
  } yield xa
</code></pre><p>Now we can <code>transact</code> our <code>doobieApp</code> with this <code>transactor</code> and convert that to the <code>ZIO</code> effect:</p><pre><code class="language-scala">val zioApp: ZIO[Any, Throwable, List[User]] =
  transactor.use(xa =&gt; doobieApp.transact(xa).compile.toList)
</code></pre><h3>Http4s</h3><p>Here is the full working example of using http4s in ZIO App:</p><h4>Cats Effect 2.x</h4><p>The following example is based on http4s&#x27;s <code>0.21.24</code> version which supports CE2:</p><pre><code class="language-scala">import cats.effect.{ConcurrentEffect, Sync, Timer}
import cats.implicits._
import fs2.Stream
import org.http4s.HttpRoutes
import org.http4s.client.blaze.BlazeClientBuilder
import org.http4s.dsl.Http4sDsl
import org.http4s.server.blaze.BlazeServerBuilder
import zio.interop.catz._
import zio.interop.catz.implicits._ 
import zio.{Task, URIO}

import scala.concurrent.ExecutionContext.global

object ZioHttp4sInterop extends CatsApp {
  def run(args: List[String]): URIO[zio.ZEnv, zio.ExitCode] =
    stream[Task].compile.drain.exitCode
  
  def stream[F[_]: ConcurrentEffect: Timer]: Stream[F, Nothing] = {
    import org.http4s.implicits._
    val httpApp = helloWorldRoute[F].orNotFound
    for {
      _ &lt;- BlazeClientBuilder[F](global).stream
      exitCode &lt;- BlazeServerBuilder[F](global)
        .bindHttp(8080, &quot;0.0.0.0&quot;)
        .withHttpApp(httpApp)
        .serve
    } yield exitCode
  }.drain

  def helloWorldRoute[F[_]: Sync]: HttpRoutes[F] = {
    val dsl = new Http4sDsl[F]{}
    import dsl._
    HttpRoutes.strict[F] {
      case GET -&gt; Root =&gt;
        Ok(&quot;Hello, World!&quot;)
    }
  }
}
</code></pre><h4>Cats Effect 3.x</h4><p>The following example is based on http4s&#x27;s <code>0.23.0-RC1</code> version which supports CE3:</p><pre><code class="language-scala">import cats.Applicative
import cats.effect.Async
import fs2.Stream
import org.http4s.HttpRoutes
import org.http4s.blaze.client.BlazeClientBuilder
import org.http4s.blaze.server.BlazeServerBuilder
import org.http4s.dsl.Http4sDsl
import zio.interop.catz._
import zio.{Task, URIO}

import scala.concurrent.ExecutionContext.global

object ZioHttp4sInterop extends zio.interop.catz.CatsApp {
  def stream[F[_]: Async]: Stream[F, Nothing] = {
    import org.http4s.implicits._
    val httpApp = helloWorldRoute[F].orNotFound
    for {
      _ &lt;- BlazeClientBuilder[F](global).stream
      exitCode &lt;- BlazeServerBuilder[F](global)
        .bindHttp(8080, &quot;0.0.0.0&quot;)
        .withHttpApp(httpApp)
        .serve
    } yield exitCode
  }.drain

  def helloWorldRoute[F[_]: Applicative]: HttpRoutes[F] = {
    val dsl = new Http4sDsl[F] {}
    import dsl._
    HttpRoutes.strict[F] { case GET -&gt; Root =&gt;
      Ok(&quot;Hello, World!&quot;)
    }
  }

  def run(args: List[String]): URIO[zio.ZEnv, zio.ExitCode] =
    stream[Task].compile.drain.exitCode
}
</code></pre></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/zio/2-0-0/howto/interop/with-cats-effect";window.___webpackCompilationHash="cdece7bd87ec0e38633f";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-0704c8948e63b1196955.js"],"app":["/app-8399cd578ff86df79336.js"],"component---node-modules-atooni-gatsby-theme-ziodoc-src-components-simple-js":["/component---node-modules-atooni-gatsby-theme-ziodoc-src-components-simple-js-900cac777aa246c3185a.js"],"component---node-modules-atooni-gatsby-theme-ziodoc-src-pages-404-js":["/component---node-modules-atooni-gatsby-theme-ziodoc-src-pages-404-js-b44617773e223797ea52.js"],"component---node-modules-atooni-gatsby-theme-ziodoc-src-pages-index-js":["/component---node-modules-atooni-gatsby-theme-ziodoc-src-pages-index-js-f82da7fc8f1ed5d041f7.js"],"component---src-pages-foo-md":["/component---src-pages-foo-md-3c304a0b5d5a13435790.js"]};/*]]>*/</script><script src="/polyfill-0704c8948e63b1196955.js" nomodule=""></script><script src="/app-8399cd578ff86df79336.js" async=""></script><script src="/1a48c3c1-3aa89e0c36dddf1a6d26.js" async=""></script><script src="/framework-ef126061ffea8930f2ad.js" async=""></script><script src="/webpack-runtime-90acb813f0122dad9372.js" async=""></script></body></html>