<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.17.2"/><style data-href="/gatsby-theme-zio/styles.0d77a1f9790ad3befaea.css" data-identity="gatsby-global-css">/*
! tailwindcss v3.1.4 | MIT License | https://tailwindcss.com
*/*,:after,:before{border:0 solid #e5e7eb;box-sizing:border-box}:after,:before{--tw-content:""}html{-webkit-text-size-adjust:100%;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{line-height:inherit;margin:0}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{color:inherit;font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }::-webkit-backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1536px){.container{max-width:1536px}}.invisible{visibility:hidden}.absolute{position:absolute}.relative{position:relative}.left-0{left:0}.top-1\/2{top:50%}.z-10{z-index:10}.m-4{margin:1rem}.m-auto{margin:auto}.my-2{margin-bottom:.5rem;margin-top:.5rem}.my-auto{margin-bottom:auto;margin-top:auto}.mx-auto{margin-left:auto;margin-right:auto}.mx-1{margin-right:.25rem}.ml-1,.mx-1{margin-left:.25rem}.mr-8{margin-right:2rem}.mt-4{margin-top:1rem}.mt-2{margin-top:.5rem}.ml-2{margin-left:.5rem}.mb-2{margin-bottom:.5rem}.ml-5{margin-left:1.25rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-8{height:2rem}.h-0{height:0}.h-40{height:10rem}.h-auto{height:auto}.w-full{width:100%}.w-auto{width:auto}.w-80{width:20rem}.w-8{width:2rem}.w-11\/12{width:91.666667%}.max-w-full{max-width:100%}.flex-initial{flex:0 1 auto}.flex-none{flex:none}.flex-grow{flex-grow:1}.list-outside{list-style-position:outside}.list-disc{list-style-type:disc}.list-decimal{list-style-type:decimal}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.place-content-center{place-content:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.rounded-lg{border-radius:.5rem}.rounded-xl{border-radius:.75rem}.rounded-sm{border-radius:.125rem}.border-2{border-width:2px}.border-r-2{border-right-width:2px}.border-solid{border-style:solid}.border-primary-50{--tw-border-opacity:1;border-color:rgb(250 250 249/var(--tw-border-opacity))}.bg-primary-700{--tw-bg-opacity:1;background-color:rgb(68 64 60/var(--tw-bg-opacity))}.bg-primary-900{--tw-bg-opacity:1;background-color:rgb(28 25 23/var(--tw-bg-opacity))}.bg-primary-100{--tw-bg-opacity:1;background-color:rgb(245 245 244/var(--tw-bg-opacity))}.bg-primary-300{--tw-bg-opacity:1;background-color:rgb(214 211 209/var(--tw-bg-opacity))}.bg-black{--tw-bg-opacity:1;background-color:rgb(0 0 0/var(--tw-bg-opacity))}.p-4{padding:1rem}.p-2{padding:.5rem}.p-8{padding:2rem}.px-1{padding-left:.25rem;padding-right:.25rem}.pb-4{padding-bottom:1rem}.pr-2{padding-right:.5rem}.text-center{text-align:center}.text-right{text-align:right}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.text-sm{font-size:.875rem;line-height:1.25rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.font-bold{font-weight:700}.font-semibold{font-weight:600}.text-primary-50{--tw-text-opacity:1;color:rgb(250 250 249/var(--tw-text-opacity))}.text-secondary-600{--tw-text-opacity:1;color:rgb(220 38 38/var(--tw-text-opacity))}.underline{-webkit-text-decoration-line:underline;text-decoration-line:underline}.hover\:rounded-md:hover{border-radius:.375rem}.hover\:bg-primary-700:hover{--tw-bg-opacity:1;background-color:rgb(68 64 60/var(--tw-bg-opacity))}.hover\:bg-primary-600:hover{--tw-bg-opacity:1;background-color:rgb(87 83 78/var(--tw-bg-opacity))}@media (min-width:768px){.md\:visible{visibility:visible}.md\:h-auto{height:auto}.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\:flex-row{flex-direction:row}}@media (min-width:1024px){.lg\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:#2f2f2f;color:#eee;font-family:Roboto Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{background:#363636}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#363636}:not(pre)>code[class*=language-]{border-radius:.2em;padding:.1em;white-space:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1.25em 1em;position:relative}.language-css>code,.language-sass>code,.language-scss>code{color:#fd9170}[class*=language-] .namespace{opacity:.7}.token.atrule{color:#c792ea}.token.attr-name{color:#ffcb6b}.token.attr-value,.token.attribute{color:#a5e844}.token.boolean{color:#c792ea}.token.builtin{color:#ffcb6b}.token.cdata,.token.char{color:#80cbc4}.token.class{color:#ffcb6b}.token.class-name{color:#f2ff00}.token.comment{color:#616161}.token.constant{color:#c792ea}.token.deleted{color:#f66}.token.doctype{color:#616161}.token.entity{color:#f66}.token.function{color:#c792ea}.token.hexcode{color:#f2ff00}.token.id,.token.important{color:#c792ea;font-weight:700}.token.inserted{color:#80cbc4}.token.keyword{color:#c792ea}.token.number{color:#fd9170}.token.operator{color:#89ddff}.token.prolog{color:#616161}.token.property{color:#80cbc4}.token.pseudo-class,.token.pseudo-element{color:#a5e844}.token.punctuation{color:#89ddff}.token.regex{color:#f2ff00}.token.selector{color:#f66}.token.string{color:#a5e844}.token.symbol{color:#c792ea}.token.tag{color:#f66}.token.unit{color:#fd9170}.token.url,.token.variable{color:#f66}</style><title data-react-helmet="true"></title></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="container mx-auto"><p><a href="https://github.com/zio/zio-telemetry">ZIO telemetry</a> is purely-functional and type-safe. It provides clients for OpenTracing and OpenTelemetry.</p><h2>Introduction</h2><p>In monolithic architecture, everything is in one place, and we know when a request starts and then how it goes through the components and when it finishes. We can obviously see what is happening with our request and where is it going. But, in distributed systems like microservice architecture, we cannot find out the story of a request through various services easily. This is where distributed tracing comes into play.</p><p>ZIO Telemetry is a purely functional client which helps up propagate context between services in a distributed environment.</p><h2>Installation</h2><p>In order to use this library, we need to add the following line in our <code>build.sbt</code> file if we want to use <a href="https://opentelemetry.io/">OpenTelemetry</a> client:</p><pre><code class="language-scala">libraryDependencies += &quot;dev.zio&quot; %% &quot;zio-telemetry&quot; % &quot;0.8.1&quot;
</code></pre><p>And for using <a href="https://opentracing.io/">OpenTracing</a> client we should add the following line in our <code>build.sbt</code> file:</p><pre><code class="language-scala">libraryDependencies += &quot;dev.zio&quot; %% &quot;zio-opentracing&quot; % &quot;0.8.1&quot;
</code></pre><h2>Example</h2><p>In this example, we create two services, <code>ProxyServer</code> and <code>BackendServer</code>. When we call ProxyServer, the BackendServer will be called.</p><p>Note that we are going to use <em>OpenTracing</em> client for this example.</p><p>Here is a simplified diagram of our services:</p><pre><code>                               ┌────────────────┐
                               │                │
                        ┌─────►│ Jaeger Backend │◄────┐
                        │      │                │     │
           Tracing Data │      └────────────────┘     │ Tracing Data
                        │                             │
               ┌────────┴─────────┐         ┌─────────┴────────┐
               │                  │         │                  │
User Request──►│   Proxy Server   ├────────►|  Backend Server  │
               │                  │         │                  │
               └──────────────────┘         └──────────────────┘
</code></pre><p>First of all we should add following dependencies to our <code>build.sbt</code> file:</p><pre><code class="language-scala">object Versions {
  val http4s         = &quot;0.21.24&quot;
  val jaeger         = &quot;1.6.0&quot;
  val sttp           = &quot;2.2.9&quot;
  val opentracing    = &quot;0.33.0&quot;
  val opentelemetry  = &quot;1.4.1&quot;
  val opencensus     = &quot;0.28.3&quot;
  val zipkin         = &quot;2.16.3&quot;
  val zio            = &quot;1.0.9&quot;
  val zioInteropCats = &quot;2.5.1.0&quot;
}

lazy val openTracingExample = Seq(
  &quot;org.typelevel&quot;                %% &quot;cats-core&quot;                     % &quot;2.6.1&quot;,
  &quot;io.circe&quot;                     %% &quot;circe-generic&quot;                 % &quot;0.14.1&quot;,
  &quot;org.http4s&quot;                   %% &quot;http4s-core&quot;                   % Versions.http4s,
  &quot;org.http4s&quot;                   %% &quot;http4s-blaze-server&quot;           % Versions.http4s,
  &quot;org.http4s&quot;                   %% &quot;http4s-dsl&quot;                    % Versions.http4s,
  &quot;org.http4s&quot;                   %% &quot;http4s-circe&quot;                  % Versions.http4s,
  &quot;io.jaegertracing&quot;              % &quot;jaeger-core&quot;                   % Versions.jaeger,
  &quot;io.jaegertracing&quot;              % &quot;jaeger-client&quot;                 % Versions.jaeger,
  &quot;io.jaegertracing&quot;              % &quot;jaeger-zipkin&quot;                 % Versions.jaeger,
  &quot;com.github.pureconfig&quot;        %% &quot;pureconfig&quot;                    % &quot;0.16.0&quot;,
  &quot;com.softwaremill.sttp.client&quot; %% &quot;async-http-client-backend-zio&quot; % Versions.sttp,
  &quot;com.softwaremill.sttp.client&quot; %% &quot;circe&quot;                         % Versions.sttp,
  &quot;dev.zio&quot;                      %% &quot;zio-interop-cats&quot;              % Versions.zioInteropCats,
  &quot;io.zipkin.reporter2&quot;           % &quot;zipkin-reporter&quot;               % Versions.zipkin,
  &quot;io.zipkin.reporter2&quot;           % &quot;zipkin-sender-okhttp3&quot;         % Versions.zipkin
)
</code></pre><p>Let&#x27;s create a <code>ZLayer</code> for <code>OpenTracing</code> which provides us Jaeger tracer. Each microservice uses this dependency to send its tracing data to the <em>Jaeger Backend</em>:</p><pre><code class="language-scala">import io.jaegertracing.Configuration
import io.jaegertracing.internal.samplers.ConstSampler
import io.jaegertracing.zipkin.ZipkinV2Reporter
import org.apache.http.client.utils.URIBuilder
import zio.ZLayer
import zio.clock.Clock
import zio.telemetry.opentracing.OpenTracing
import zipkin2.reporter.AsyncReporter
import zipkin2.reporter.okhttp3.OkHttpSender

object JaegerTracer {
  def makeJaegerTracer(host: String, serviceName: String): ZLayer[Clock, Throwable, Clock with OpenTracing] =
    OpenTracing.live(new Configuration(serviceName)
      .getTracerBuilder
      .withSampler(new ConstSampler(true))
      .withReporter(
        new ZipkinV2Reporter(
          AsyncReporter.create(
            OkHttpSender.newBuilder
              .compressionEnabled(true)
              .endpoint(
                new URIBuilder()
                  .setScheme(&quot;http&quot;)
                  .setHost(host)
                  .setPath(&quot;/api/v2/spans&quot;)
                  .build.toString
              )
              .build
          )
        )
      )
      .build
    ) ++ Clock.live
}
</code></pre><p>The <em>BackendServer</em>:</p><pre><code class="language-scala">import io.opentracing.propagation.Format.Builtin.{HTTP_HEADERS =&gt; HttpHeadersFormat}
import io.opentracing.propagation.TextMapAdapter
import org.http4s._
import org.http4s.dsl.Http4sDsl
import org.http4s.server.Router
import org.http4s.server.blaze.BlazeServerBuilder
import org.http4s.syntax.kleisli._
import zio.clock.Clock
import zio.interop.catz._
import zio.telemetry.opentracing._
import JaegerTracer.makeJaegerTracer
import zio.{ExitCode, ZEnv, ZIO}

import scala.jdk.CollectionConverters._

object BackendServer extends CatsApp {
  type AppTask[A] = ZIO[Clock, Throwable, A]

  val dsl: Http4sDsl[AppTask] = Http4sDsl[AppTask]
  import dsl._

  override def run(args: List[String]): ZIO[ZEnv, Nothing, ExitCode] =
    ZIO.runtime[Clock].flatMap { implicit runtime =&gt;
      BlazeServerBuilder[AppTask](runtime.platform.executor.asEC)
        .bindHttp(port = 9000, host = &quot;0.0.0.0&quot;)
        .withHttpApp(
          Router[AppTask](mappings = &quot;/&quot; -&gt;
            HttpRoutes.of[AppTask] { case request@GET -&gt; Root =&gt;
              ZIO.unit
                .spanFrom(
                  format = HttpHeadersFormat,
                  carrier = new TextMapAdapter(request.headers.toList.map(h =&gt; h.name.value -&gt; h.value).toMap.asJava),
                  operation = &quot;GET /&quot;
                )
                .provide(makeJaegerTracer(host = &quot;0.0.0.0:9411&quot;, serviceName = &quot;backend-service&quot;)) *&gt; Ok(&quot;Ok!&quot;)
            }
          ).orNotFound
        )
        .serve
        .compile
        .drain
    }.exitCode
}
</code></pre><p>And the <em>ProxyServer</em> which calls the <em>BackendServer</em>:</p><pre><code class="language-scala">import cats.effect.{ExitCode =&gt; catsExitCode}
import io.opentracing.propagation.Format.Builtin.{HTTP_HEADERS =&gt; HttpHeadersFormat}
import io.opentracing.propagation.TextMapAdapter
import io.opentracing.tag.Tags
import org.http4s.HttpRoutes
import org.http4s.dsl.Http4sDsl
import org.http4s.server.Router
import org.http4s.server.blaze.BlazeServerBuilder
import org.http4s.syntax.kleisli._
import sttp.client.asynchttpclient.zio.AsyncHttpClientZioBackend
import sttp.client.basicRequest
import sttp.model.Uri
import zio.clock.Clock
import zio.interop.catz._
import zio.telemetry.opentracing.OpenTracing
import JaegerTracer.makeJaegerTracer
import zio.{ExitCode, UIO, ZEnv, ZIO}

import scala.collection.mutable
import scala.jdk.CollectionConverters._

object ProxyServer extends CatsApp {

  type AppTask[A] = ZIO[Clock, Throwable, A]

  private val backend = AsyncHttpClientZioBackend()

  override def run(args: List[String]): ZIO[ZEnv, Nothing, ExitCode] =
    ZIO.runtime[Clock].flatMap { implicit runtime =&gt;
      implicit val ec = runtime.platform.executor.asEC
      BlazeServerBuilder[AppTask](ec)
        .bindHttp(port = 8080, host = &quot;0.0.0.0&quot;)
        .withHttpApp(
          Router[AppTask](mappings = &quot;/&quot; -&gt; {
            val dsl: Http4sDsl[AppTask] = Http4sDsl[AppTask]
            import dsl._

            HttpRoutes.of[AppTask] { case GET -&gt; Root =&gt;
              (for {
                _ &lt;- OpenTracing.tag(Tags.SPAN_KIND.getKey, Tags.SPAN_KIND_CLIENT)
                _ &lt;- OpenTracing.tag(Tags.HTTP_METHOD.getKey, GET.name)
                _ &lt;- OpenTracing.setBaggageItem(&quot;proxy-baggage-item-key&quot;, &quot;proxy-baggage-item-value&quot;)
                buffer = new TextMapAdapter(mutable.Map.empty[String, String].asJava)
                _ &lt;- OpenTracing.provide(HttpHeadersFormat, buffer)
                headers &lt;- extractHeaders(buffer)
                res &lt;-
                  backend.flatMap { implicit backend =&gt;
                    basicRequest.get(Uri(&quot;0.0.0.0&quot;, 9000).path(&quot;/&quot;)).headers(headers).send()
                  }.map(_.body)
                    .flatMap {
                      case Right(_) =&gt; Ok(&quot;Ok!&quot;)
                      case Left(_) =&gt; Ok(&quot;Oops!&quot;)
                    }
              } yield res)
                .root(operation = &quot;GET /&quot;)
                .provide(
                  makeJaegerTracer(host = &quot;0.0.0.0:9411&quot;, serviceName = &quot;proxy-server&quot;)
                )
            }
          }).orNotFound
        )
        .serve
        .compile[AppTask, AppTask, catsExitCode]
        .drain
        .as(ExitCode.success)
    }.exitCode

  private def extractHeaders(adapter: TextMapAdapter): UIO[Map[String, String]] = {
    val m = mutable.Map.empty[String, String]
    UIO(adapter.forEach { entry =&gt;
      m.put(entry.getKey, entry.getValue)
      ()
    }).as(m.toMap)
  }

}
</code></pre><p>First, we run the following command to start Jaeger backend:</p><pre><code class="language-bash">docker run -d --name jaeger \
  -e COLLECTOR_ZIPKIN_HTTP_PORT=9411 \
  -p 5775:5775/udp \
  -p 6831:6831/udp \
  -p 6832:6832/udp \
  -p 5778:5778 \
  -p 16686:16686 \
  -p 14268:14268 \
  -p 9411:9411 \
  jaegertracing/all-in-one:1.6
</code></pre><p>It&#x27;s time to run Backend and Proxy servers. After starting these two, we can start calling <code>ProxyServer</code>:</p><pre><code class="language-scala">curl -X GET http://0.0.0.0:8080/
</code></pre><p>Now we can check the Jaeger service (http://localhost:16686/) to see the result.</p><h2>Articles</h2><ul><li><a href="https://kadek-marek.medium.com/trace-your-microservices-with-zio-telemetry-5f88d69cb26b">Trace your microservices with ZIO</a> by Marek Kadek (September 2021)</li></ul></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/zio/2-0-0/resources/ecosystem/officials/zio-telemetry";window.___webpackCompilationHash="629750c28ce5e2d26819";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-0704c8948e63b1196955.js"],"app":["/app-5bc2dca3fcd03febe812.js"],"component---node-modules-atooni-gatsby-theme-ziodoc-src-components-simple-js":["/component---node-modules-atooni-gatsby-theme-ziodoc-src-components-simple-js-900cac777aa246c3185a.js"],"component---node-modules-atooni-gatsby-theme-ziodoc-src-pages-404-js":["/component---node-modules-atooni-gatsby-theme-ziodoc-src-pages-404-js-b44617773e223797ea52.js"],"component---node-modules-atooni-gatsby-theme-ziodoc-src-pages-index-js":["/component---node-modules-atooni-gatsby-theme-ziodoc-src-pages-index-js-d0913b8933fa48a45475.js"],"component---src-pages-foo-md":["/component---src-pages-foo-md-3c304a0b5d5a13435790.js"]};/*]]>*/</script><script src="/gatsby-theme-zio/polyfill-0704c8948e63b1196955.js" nomodule=""></script><script src="/gatsby-theme-zio/app-5bc2dca3fcd03febe812.js" async=""></script><script src="/gatsby-theme-zio/1a48c3c1-3aa89e0c36dddf1a6d26.js" async=""></script><script src="/gatsby-theme-zio/framework-ef126061ffea8930f2ad.js" async=""></script><script src="/gatsby-theme-zio/webpack-runtime-7117cab68cf800d067d6.js" async=""></script></body></html>